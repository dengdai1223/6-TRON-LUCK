<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRON 钱包连接示例</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
        #connectButton { padding: 10px 20px; font-size: 16px; cursor: pointer; }
        #statusMessage { margin-top: 20px; color: red; }
    </style>
</head>
<body>

    <h1>连接 TRON 钱包</h1>
    <button id="connectButton" onclick="connectWallet()">连接钱包</button>
    <p id="statusMessage"></p>

    <script>
        function connectWallet() {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = '正在尝试连接...';
            
            // ----------------------------------------------------
            // 1. **判断是否在 App 内置浏览器（DApp 浏览器）**
            // 如果用户已经在 TronLink 或 TokenPocket 的内置浏览器中打开，
            // 通常会有一个全局对象（如 window.tronWeb）可供使用。
            // ----------------------------------------------------
            if (window.tronWeb) {
                statusElement.textContent = '检测到 TRON DApp 浏览器环境，可以直接操作 TRON Web。';
                // 在这里可以编写具体的 tronWeb 交互逻辑，例如：
                // window.tronWeb.defaultAddress.base58; // 获取地址
                return;
            }

            // ----------------------------------------------------
            // 2. **尝试通过 Deep Link 唤起外部 App**
            // 这是在普通手机浏览器（如 Safari/Chrome）中唤起 App 的方法。
            // 注意：URI 协议必须由钱包 App 注册支持。
            // ----------------------------------------------------
            
            // 目标 URI 协议：通常是 tronlink:// 或类似的协议
            // 实际连接操作可能需要一个具体的 DApp URL 或操作参数
            const deepLinkURI = 'tronlink://'; // 基础唤醒协议
            // 也可以尝试连接特定的 DApp:
            // const deepLinkURI = 'tronlink://?action=openDapp&url=' + encodeURIComponent(window.location.href);

            const isiOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);

            if (isiOS || isAndroid) {
                // 设置一个计时器，如果在短时间内（例如 1500ms）没有跳转，
                // 认为 App 未安装，引导用户去下载。
                const fallbackTimer = setTimeout(() => {
                    // 如果定时器触发，说明 App 未被唤醒（可能未安装）
                    statusElement.innerHTML = 'TRON 钱包未检测到，请确认您已安装 TronLink 或 TokenPocket。<br>您可以在此下载：';

                    if (isiOS) {
                         // 替换为您的应用在 App Store 的链接
                         statusElement.innerHTML += '<br><a href="itms-apps://itunes.apple.com/app/id1455584558">iOS App Store 下载 (TronLink)</a>';
                    } else if (isAndroid) {
                        // 替换为您的应用在 Google Play 的链接
                        statusElement.innerHTML += '<br><a href="market://details?id=com.tronlink.wallet">Android Google Play 下载 (TronLink)</a>';
                    }
                }, 1500);

                // 尝试通过改变 window.location 来唤起 App
                window.location.href = deepLinkURI;

                // 监听 visibilitychange 事件，如果页面隐藏后又显示，
                // 说明 App 可能被成功唤醒并返回了，可以清除 fallback timer。
                document.addEventListener('visibilitychange', function handler() {
                    if (!document.hidden) {
                        clearTimeout(fallbackTimer);
                        statusElement.textContent = 'TRON 钱包可能已打开，请检查您的钱包 App。';
                        document.removeEventListener('visibilitychange', handler);
                    }
                });

            } else {
                // 桌面或不支持的环境
                statusElement.textContent = '请使用移动设备浏览器访问，或安装 TRON 浏览器扩展钱包。';
            }
        }
    </script>
</body>
</html>
